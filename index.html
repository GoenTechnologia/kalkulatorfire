<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binder Fire Simple Risk - Penawaran</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS UTAMA (DESKTOP DEFAULT) --- */
        :root { --bg-app: #f0f2f5; --sidebar-width: 420px; --primary: #2c3e50; --accent: #3498db; --border: #ddd; }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background: var(--bg-app); 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
        }
        
        /* SIDEBAR */
        .sidebar { 
            width: var(--sidebar-width); 
            background: white; 
            border-right: 1px solid var(--border); 
            display: flex; 
            flex-direction: column; 
            z-index: 10; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.05); 
        }
        .sidebar-content { padding: 20px; overflow-y: auto; flex: 1; }
        .sidebar h2 { color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-top: 0; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 0.85rem; font-weight: 600; color: #555; margin-bottom: 5px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        textarea.form-control { resize: vertical; }
        
        .section-box { background: #f8f9fa; padding: 10px; border: 1px solid #eee; border-radius: 4px; margin-bottom: 15px; }
        .section-title { font-size: 0.8rem; font-weight: bold; color: var(--primary); margin-bottom: 8px; text-transform: uppercase; border-bottom: 1px solid #ddd; padding-bottom: 5px; }

        .checkbox-group { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #333; margin-bottom: 10px; }
        .checkbox-group input { width: 18px; height: 18px; cursor: pointer; }

        .risk-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .risk-item { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; }
        .risk-item input { width: 18px; height: 18px; }

        .tsi-wrapper { background: #fff; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .tsi-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .btn-add { width: 100%; background: white; border: 1px dashed var(--accent); color: var(--accent); padding: 8px; cursor: pointer; margin-top: 5px; font-weight: 500; }
        
        .sidebar-footer { padding: 15px; background: white; border-top: 1px solid var(--border); }
        .btn-print { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: bold; }
        .btn-print:hover { background: #1a252f; }

        /* PREVIEW AREA */
        .preview { flex: 1; background: #525659; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; gap: 30px; }
        
        /* KERTAS A4 */
        .page { 
            background: white; 
            width: 210mm; 
            min-height: 297mm; 
            padding: 20mm; 
            box-shadow: 0 0 15px rgba(0,0,0,0.3); 
            font-family: 'Roboto', sans-serif; 
            font-size: 9pt; /* UKURAN FONT 9pt */
            line-height: 1.3;
            color: #000; 
            position: relative; 
            box-sizing: border-box; 
        }
        
        .binder-header { 
            text-align: center; font-weight: bold; font-size: 14pt; 
            text-decoration: underline; margin-bottom: 20px; 
            text-transform: uppercase; line-height: 1.2;
        }
        
        table.binder-table { width: 100%; border-collapse: collapse; }
        table.binder-table td { vertical-align: top; padding: 4px 0; }
        .c-lbl { width: 25%; font-weight: bold; }
        .c-sep { width: 2%; text-align: center; }
        .c-val { width: 73%; text-align: justify; }
        
        .rate-table { width: 100%; margin-bottom: 10px; }
        .rate-table td { padding: 1px 0; }
        
        .calc-box { margin-top: 5px; padding: 10px; border: 1px solid #000; background: #fafafa; }
        .calc-row { display: flex; justify-content: space-between; margin-bottom: 2px; }
        .calc-total { font-weight: bold; border-top: 1px dashed #666; margin-top: 5px; padding-top: 5px; font-size: 1.1em; }

        /* FOOTNOTE STYLE */
        .footer-note {
            position: absolute;
            bottom: 20mm;
            right: 20mm;
            font-size: 8pt;
            font-style: italic;
            color: #555;
            text-align: right;
        }

        /* --- MOBILE RESPONSIVE (MAX WIDTH 900px) --- */
        @media screen and (max-width: 900px) {
            body { flex-direction: column; height: auto; overflow-y: auto; }
            .sidebar { width: 100%; height: auto; box-shadow: none; border-right: none; border-bottom: 1px solid var(--border); }
            .sidebar-content { height: auto; padding-bottom: 80px; }
            .sidebar-footer { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 100; box-shadow: 0 -4px 10px rgba(0,0,0,0.1); padding: 10px 15px; box-sizing: border-box; }
            .preview { width: 100%; height: auto; padding: 20px 10px 100px 10px; overflow-x: auto; display: block; background: #e0e0e0; }
            .page { margin: 0 auto 20px auto; min-width: 210mm; transform-origin: top left; }
        }

        /* --- SETTING PRINT --- */
        @media print {
            @page { size: A4; margin: 0; }
            body { background: white; height: auto; overflow: visible; display: block; }
            .sidebar, .sidebar-footer { display: none !important; }
            .preview { padding: 0; margin: 0; background: white; display: block; height: auto; overflow: visible; }
            .page { box-shadow: none; width: 100%; min-height: 297mm; margin: 0; padding: 20mm; page-break-after: auto; border: none; min-width: auto; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-content">
            <h2 style="display:flex; justify-content:space-between; align-items:center;">
                Input Data
                <span style="font-size:0.6em; color:#888; font-weight:normal;">v3.3 Lite</span>
            </h2>
            
            <div class="form-group">
                <label>Insured Name</label>
                <input type="text" id="insuredName" class="form-control" oninput="render()" placeholder="Nama Tertanggung">
            </div>
            
            <div class="form-group">
                <label>Insured Address</label>
                <textarea id="addressInput" class="form-control" rows="2" placeholder="Jalan, Gedung, No..." oninput="render()"></textarea>
            </div>

            <div class="section-box">
                <div class="section-title">Location of Risk</div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="chkSameLocation" onchange="toggleLocationText()">
                    <label for="chkSameLocation">Sama dengan Insured Address</label>
                </div>

                <div id="riskAddressTextDiv" class="form-group">
                    <label>Detail Alamat Risiko</label>
                    <textarea id="riskAddressInput" class="form-control" rows="2" placeholder="Jika berbeda, tulis disini..." oninput="render()"></textarea>
                </div>

                <div style="background: #eef2f7; padding: 10px; border-radius: 4px; border: 1px dashed #bbb;">
                    <label style="color:var(--primary); font-size:0.8rem;">Wajib Pilih (Untuk Zona Gempa)</label>
                    <div style="margin-bottom: 8px;">
                        <select id="provinsiSelect" class="form-control" onchange="populateCities()">
                            <option value="">-- Pilih Provinsi --</option>
                        </select>
                    </div>
                    <div>
                        <select id="kotaSelect" class="form-control" onchange="render()">
                            <option value="">-- Pilih Kota/Kab --</option>
                        </select>
                    </div>
                    <div id="zoneDisplay" style="font-size: 0.8rem; color: green; margin-top: 5px; font-weight: bold; text-align: right;"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Inception Date</label>
                <input type="date" id="startDate" class="form-control" onchange="render()">
            </div>

            <div class="form-group">
                <label>Occupation</label>
                <select id="occupationSelect" class="form-control" onchange="render()">
                    <option value="">-- Select Occupation --</option>
                </select>
            </div>

            <div class="section-box">
                <div class="section-title">Sum Insured & Risks</div>
                <div class="tsi-wrapper">
                    <div id="tsiContainer"></div>
                    <button type="button" class="btn-add" onclick="addTsiRow()">+ Tambah Item</button>
                    <div style="text-align: right; font-weight: bold; margin-top: 5px; font-size:1.1em; color:#2c3e50;" id="totalInputDisplay">IDR 0</div>
                </div>
                
                <div style="margin-top: 15px;">
                    <label style="font-size:0.85rem; font-weight:600; margin-bottom:8px; display:block;">Additional Risks:</label>
                    <div class="risk-options">
                        <label class="risk-item"><input type="checkbox" id="chk_rsmd" onchange="render()"> RSMDCC</label>
                        <label class="risk-item"><input type="checkbox" id="chk_tsfwd" onchange="render()"> TSFWD</label>
                        <label class="risk-item"><input type="checkbox" id="chk_others" onchange="render()"> Others</label>
                        <label class="risk-item"><input type="checkbox" id="chk_eq" onchange="render()"> EQVETS</label>
                    </div>
                </div>
            </div>

        </div>
        <div class="sidebar-footer">
            <button class="btn-print" onclick="handlePrint()">üñ®Ô∏è Cetak / Simpan PDF</button>
        </div>
    </div>

    <div class="preview">
        <div class="page">
            <div class="binder-header">SURAT PENAWARAN<br>FIRE SIMPLE RISK</div>
            
            <table class="binder-table">
                <tr><td class="c-lbl">Type</td><td class="c-sep">:</td><td class="c-val" id="outType"></td></tr>
                <tr><td class="c-lbl">Insured Name</td><td class="c-sep">:</td><td class="c-val"><strong id="outName">TBA</strong></td></tr>
                <tr><td class="c-lbl">Address</td><td class="c-sep">:</td><td class="c-val" id="outAddress">Indonesian territory</td></tr>
                <tr><td class="c-lbl">Insurance Period</td><td class="c-sep">:</td><td class="c-val" id="outPeriod">To be advised</td></tr>
                <tr><td class="c-lbl">Occupation</td><td class="c-sep">:</td><td class="c-val" id="outOccupation">As Per Attachment</td></tr>
                <tr><td class="c-lbl">Location Of Risks</td><td class="c-sep">:</td><td class="c-val" id="outLocation">Indonesian territory</td></tr>
                
                <tr><td class="c-lbl">Total Sum Insured</td><td class="c-sep">:</td><td class="c-val"><strong id="outTotalSum">IDR 0</strong><div id="outTsiDetails" style="font-size:0.9em; margin-top:5px;"></div></td></tr>
                
                <tr><td class="c-lbl">Main Coverage</td><td class="c-sep">:</td><td class="c-val">FLEXAS (Fire, Lightning, Explosion, Aircraft Impact, Smoke)</td></tr>
                
                <tr><td class="c-lbl">Additional Coverage</td><td class="c-sep">:</td><td class="c-val" id="outAddCoverage">-</td></tr>
                
                <tr>
                    <td class="c-lbl">Deductible</td><td class="c-sep">:</td>
                    <td class="c-val">
                        <b>FLEXAS:</b> Nil, except code 2934/2930/29395/29312 /29311/2933/23002/23003: 5% of Claim or 0.1% of TSI (whichever is higher)
                        <span id="deductible_rsmd"></span>
                        <span id="deductible_tsfwd"></span>
                        <span id="deductible_others"></span>
                        <span id="deductible_eq"></span>
                    </td>
                </tr>

                <tr>
                    <td class="c-lbl" style="padding-top:15px">Premium Calculation</td><td class="c-sep" style="padding-top:15px">:</td>
                    <td class="c-val" style="padding-top:15px">
                        <table class="rate-table">
                            <tbody id="rateTableBody"></tbody>
                        </table>
                        <div class="calc-box" id="calcSection">
                            <div class="calc-row"><span>Total Sum Insured</span><span id="calcTsi">IDR 0</span></div>
                            <div class="calc-row"><span>Total Rate</span><span id="calcRate">0.0000%</span></div>
                            <div class="calc-row calc-total"><span>Premium</span><span id="calcPremium">IDR 0</span></div>
                            <div style="margin-top: 5px; font-style: italic; font-size: 0.8em;">(premium diatas, belum termasuk biaya polis)</div>
                        </div>
                    </td>
                </tr>
            </table>

            <div class="footer-note">
                calculated by<br>
                goen's insurance machine
            </div>
        </div>
    </div>

    <script src="data_okupasi.js"></script>
    <script src="data_zona.js"></script>

    <script>
        // --- DATA TARIF GEMPA OJK (per mil) ---
        const eqRateDwelling = { "1": 0.76, "2": 0.79, "3": 1.04, "4": 1.35, "5": 1.60 };
        const eqRateCommercial = { "1": 0.75, "2": 0.76, "3": 1.00, "4": 1.43, "5": 1.90 };

        // --- INIT ---
        function toggleLocationText() {
            const isSame = document.getElementById('chkSameLocation').checked;
            const manualDiv = document.getElementById('riskAddressTextDiv');
            manualDiv.style.display = isSame ? 'none' : 'block';
            render();
        }

        // --- FUNGSI PRINT & RENAME ---
        function handlePrint() {
            const originalTitle = document.title;
            const nameInput = document.getElementById('insuredName').value;
            let fileName = "QS_SimpleRisk_Lite";
            
            if (nameInput && nameInput.trim() !== "") {
                const cleanName = nameInput.replace(/[^a-zA-Z0-9 ]/g, "").substring(0, 30).trim();
                if(cleanName) fileName += "_" + cleanName;
            }

            document.title = fileName;
            window.print();
            
            setTimeout(() => {
                document.title = originalTitle;
            }, 1000);
        }

        const occSelect = document.getElementById('occupationSelect');
        occupationData.forEach(item => {
            const opt = document.createElement('option');
            opt.value = item.code;
            opt.text = `${item.code} - ${item.name.substring(0, 50)}...`;
            occSelect.appendChild(opt);
        });

        const provSelect = document.getElementById('provinsiSelect');
        const sortedProv = Object.keys(zonaGempaData).sort();
        sortedProv.forEach(prov => {
            const opt = document.createElement('option');
            opt.value = prov;
            opt.text = prov;
            provSelect.appendChild(opt);
        });

        function populateCities() {
            const prov = document.getElementById('provinsiSelect').value;
            const citySelect = document.getElementById('kotaSelect');
            citySelect.innerHTML = '<option value="">-- Pilih Kota/Kab --</option>';

            if(prov && zonaGempaData[prov]) {
                const cities = Object.keys(zonaGempaData[prov]).sort();
                cities.forEach(city => {
                    const opt = document.createElement('option');
                    opt.value = city;
                    opt.text = city;
                    citySelect.appendChild(opt);
                });
            }
            render();
        }

        function addTsiRow(label="Item", val=0) {
            const div = document.createElement('div');
            div.className = 'tsi-row';
            div.innerHTML = `
                <input type="text" class="form-control tsi-name" placeholder="Item Name" value="${label}">
                <input type="number" class="form-control tsi-val" placeholder="0" value="${val}" oninput="render()">
                <button onclick="this.parentElement.remove(); render()" style="background:red; color:white; border:none;">x</button>
            `;
            document.getElementById('tsiContainer').appendChild(div);
            render();
        }
        addTsiRow("Building", 0);
        addTsiRow("Contents", 0);

        // --- CORE RENDER FUNCTION ---
        function render() {
            // A. Identity
            document.getElementById('outName').innerText = document.getElementById('insuredName').value || "TBA (As per declaration)";
            const insuredAddr = document.getElementById('addressInput').value;
            document.getElementById('outAddress').innerText = insuredAddr || "Indonesian territory";

            // B. Date
            const dateVal = document.getElementById('startDate').value;
            if(dateVal) {
                const d = new Date(dateVal);
                const e = new Date(d); e.setFullYear(d.getFullYear()+1);
                const opts = { day: 'numeric', month: 'long', year: 'numeric' };
                document.getElementById('outPeriod').innerHTML = 
                    `${d.toLocaleDateString('id-ID', opts)} to ${e.toLocaleDateString('id-ID', opts)}<br>` + 
                    `(both dates inclusive) at 12:00 noon local time (Subject to no claim)`;
            } else {
                document.getElementById('outPeriod').innerText = "Up to 12 Months from the date to be advised...";
            }

            // C. Occupation & Flexas Rate
            const code = occSelect.value;
            const occData = occupationData.find(x => x.code === code);
            let flexasRate = 0;
            if(occData) {
                document.getElementById('outOccupation').innerText = `${occData.name} (Code: ${code})`;
                flexasRate = occData.rate;
            } else {
                document.getElementById('outOccupation').innerText = "As Per Attachment";
            }

            // D. Location & Zone
            const isSameLoc = document.getElementById('chkSameLocation').checked;
            const prov = document.getElementById('provinsiSelect').value;
            const city = document.getElementById('kotaSelect').value;
            
            let locText = isSameLoc ? (insuredAddr || "Same as Insured Address") : (document.getElementById('riskAddressInput').value || "Indonesian territory");
            let currentZone = "";
            let regionSuffix = "";
            
            if (prov && city) {
                currentZone = zonaGempaData[prov][city];
                regionSuffix = `<br>(${city}, ${prov} - Zona Gempa: ${currentZone})`;
                document.getElementById('zoneDisplay').innerText = `Zone: ${currentZone}`;
            } else {
                document.getElementById('zoneDisplay').innerText = "Zone: ?";
            }
            
            document.getElementById('outLocation').innerHTML = locText + regionSuffix;

            // E. TSI
            let totalSum = 0;
            let tsiHtml = "";
            document.querySelectorAll('.tsi-row').forEach(row => {
                const n = row.querySelector('.tsi-name').value;
                const v = parseFloat(row.querySelector('.tsi-val').value) || 0;
                totalSum += v;
                if(v > 0) tsiHtml += `<div>${n}: ${new Intl.NumberFormat('id-ID', {style:'currency', currency:'IDR'}).format(v)}</div>`;
            });
            document.getElementById('outTotalSum').innerText = new Intl.NumberFormat('id-ID', {style:'currency', currency:'IDR'}).format(totalSum);
            document.getElementById('totalInputDisplay').innerText = new Intl.NumberFormat('id-ID', {style:'currency', currency:'IDR'}).format(totalSum);
            document.getElementById('outTsiDetails').innerHTML = tsiHtml;

            // F. Risks & Type
            const isRsmd = document.getElementById('chk_rsmd').checked;
            const isTsfwd = document.getElementById('chk_tsfwd').checked;
            const isOthers = document.getElementById('chk_others').checked;
            const isEq = document.getElementById('chk_eq').checked;
            
            const isAnyParRisk = isRsmd || isTsfwd || isOthers;
            let typeHtml = "";
            if(!isAnyParRisk && !isEq) {
                typeHtml = `Fire Insurance<br>- Indonesian Fire Insurance Standard Policy (PSAKI)`;
            } else if(!isAnyParRisk && isEq) {
                typeHtml = `Fire Insurance & Earthquake<br>- PSAKI & PSAGBI`;
            } else if(isAnyParRisk && !isEq) {
                typeHtml = `Property "All" Risk Insurance<br>- PAR Munich Re standard wording`;
            } else if(isAnyParRisk && isEq) {
                typeHtml = `Property "All" Risk & Earthquake<br>- PAR Munich Re & PSAGBI`;
            }
            document.getElementById('outType').innerHTML = typeHtml;

            // COVERAGE (DENGAN KEPANJANGAN)
            let addCovList = [];
            if(isRsmd) addCovList.push("RSMDCC (Riot, Strike, Malicious Damage, Civil Commotion)");
            if(isTsfwd) addCovList.push("TSFWD (Typhoon, Storm, Flood, Water Damage)");
            if(isOthers) addCovList.push("Others");
            if(isEq) addCovList.push("EQVETS (Earthquake, Volcanic Eruption, Tsunami)");
            document.getElementById('outAddCoverage').innerHTML = addCovList.length > 0 ? addCovList.join("<br>") : "-";

            // DEDUCTIBLES
            document.getElementById('deductible_rsmd').innerHTML = isRsmd ? "<br><b>RSMDCC:</b> 10% of claim minimum IDR 10,000,000.-" : "";
            document.getElementById('deductible_tsfwd').innerHTML = isTsfwd ? "<br><b>TSFWD:</b> 10% of claim amount minimum IDR 10,000,000.-" : "";
            document.getElementById('deductible_others').innerHTML = isOthers ? "<br><b>Others:</b> IDR 1,000,000.00" : "";
            document.getElementById('deductible_eq').innerHTML = isEq ? "<br><b>EQVETS:</b> 2.5% of total sum insured" : "";

            // G. Rate & Calc
            const tableBody = document.getElementById('rateTableBody');
            tableBody.innerHTML = "";
            let totalRateVal = flexasRate; 

            // FLEXAS
            tableBody.innerHTML += `<tr><td width="100"><b>FLEXAS</b></td><td>: ${flexasRate > 0 ? flexasRate + '%' : 'as per OJK'}</td></tr>`;
            
            if(isRsmd) {
                totalRateVal += 0.0001;
                tableBody.innerHTML += `<tr><td><b>RSMDCC</b></td><td>: 0.0001% (min rate)</td></tr>`;
            }
            
            if(isTsfwd) {
                let tsfwdRate = 0.045; 
                const highRiskProvs = ["DKI JAKARTA", "BANTEN", "JAWA BARAT"];
                if(highRiskProvs.includes(prov)) tsfwdRate = 0.050;
                totalRateVal += tsfwdRate;
                tableBody.innerHTML += `<tr><td><b>TSFWD</b></td><td>: ${tsfwdRate}%</td></tr>`;
            }
            
            if(isOthers) {
                totalRateVal += 0.0001;
                tableBody.innerHTML += `<tr><td><b>Others</b></td><td>: 0.0001% (min rate)</td></tr>`;
            }
            
            if(isEq) {
                let eqRatePercent = 0;
                let eqText = "";
                if (currentZone) {
                    let perMil = 0;
                    if(code === "2976") {
                        perMil = eqRateDwelling[currentZone] || 0;
                    } else {
                        perMil = eqRateCommercial[currentZone] || 0;
                    }
                    eqRatePercent = perMil / 10;
                    eqText = `${eqRatePercent.toFixed(4)}% [Zone ${currentZone}]`;
                } else {
                    eqText = "Select Zone";
                }
                totalRateVal += eqRatePercent;
                tableBody.innerHTML += `<tr><td><b>EQ</b></td><td>: ${eqText}</td></tr>`;
            }

            const premiumVal = totalSum * (totalRateVal / 100);
            document.getElementById('calcTsi').innerText = new Intl.NumberFormat('id-ID', {style:'currency', currency:'IDR'}).format(totalSum);
            document.getElementById('calcRate').innerText = totalRateVal.toFixed(5) + '%';
            document.getElementById('calcPremium').innerText = new Intl.NumberFormat('id-ID', {style:'currency', currency:'IDR'}).format(premiumVal);
        }

        render();
    </script>
</body>
</html>